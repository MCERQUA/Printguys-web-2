# TASK T008: Build Shopping Cart Store (Zustand)

## OBJECTIVE
Create a Zustand store for shopping cart functionality.

## PROJECT LOCATION
/home/nick/Nick/Printguys-AI/printguys-nextjs

## CONTEXT
- Zustand 5.0.10 is already installed
- Need persistent cart that survives page refreshes
- Cart items should include product details, quantities, customizations

## INSTRUCTIONS

1. Create cart store at /src/stores/cart-store.ts:
```typescript
import { create } from 'zustand'
import { persist, createJSONStorage } from 'zustand/middleware'

export interface CartItem {
  id: string
  name: string
  productType: string
  service: string  // dtf, screen-printing, embroidery, etc.
  quantity: number
  sizes: { [size: string]: number }  // { S: 5, M: 10, L: 5 }
  color: string
  unitPrice: number
  totalPrice: number
  designId?: string
  designThumbnail?: string
  customizations?: {
    frontDesign?: boolean
    backDesign?: boolean
    notes?: string
  }
}

interface CartState {
  items: CartItem[]
  isOpen: boolean

  // Actions
  addItem: (item: Omit<CartItem, 'id'>) => void
  removeItem: (id: string) => void
  updateQuantity: (id: string, quantity: number) => void
  updateSizes: (id: string, sizes: { [size: string]: number }) => void
  clearCart: () => void
  toggleCart: () => void
  openCart: () => void
  closeCart: () => void

  // Computed
  totalItems: () => number
  subtotal: () => number
  itemCount: () => number
}

export const useCartStore = create<CartState>()(
  persist(
    (set, get) => ({
      items: [],
      isOpen: false,

      addItem: (item) => {
        const id = `cart-${Date.now()}-${Math.random().toString(36).slice(2)}`
        set((state) => ({
          items: [...state.items, { ...item, id }]
        }))
      },

      removeItem: (id) => {
        set((state) => ({
          items: state.items.filter((item) => item.id !== id)
        }))
      },

      updateQuantity: (id, quantity) => {
        set((state) => ({
          items: state.items.map((item) =>
            item.id === id
              ? { ...item, quantity, totalPrice: item.unitPrice * quantity }
              : item
          )
        }))
      },

      updateSizes: (id, sizes) => {
        const totalQty = Object.values(sizes).reduce((a, b) => a + b, 0)
        set((state) => ({
          items: state.items.map((item) =>
            item.id === id
              ? {
                  ...item,
                  sizes,
                  quantity: totalQty,
                  totalPrice: item.unitPrice * totalQty
                }
              : item
          )
        }))
      },

      clearCart: () => set({ items: [] }),

      toggleCart: () => set((state) => ({ isOpen: !state.isOpen })),
      openCart: () => set({ isOpen: true }),
      closeCart: () => set({ isOpen: false }),

      totalItems: () => get().items.reduce((sum, item) => sum + item.quantity, 0),
      subtotal: () => get().items.reduce((sum, item) => sum + item.totalPrice, 0),
      itemCount: () => get().items.length,
    }),
    {
      name: 'printguys-cart',
      storage: createJSONStorage(() => localStorage),
      partialize: (state) => ({ items: state.items }), // Only persist items
    }
  )
)

// Helper hooks
export const useCartItems = () => useCartStore((state) => state.items)
export const useCartOpen = () => useCartStore((state) => state.isOpen)
export const useCartActions = () => useCartStore((state) => ({
  addItem: state.addItem,
  removeItem: state.removeItem,
  updateQuantity: state.updateQuantity,
  clearCart: state.clearCart,
  toggleCart: state.toggleCart,
}))
```

2. Create stores index at /src/stores/index.ts:
```typescript
export * from './cart-store'
```

3. Test the store in browser console:
```javascript
// Open browser, go to http://localhost:3000
// In console:
const { useCartStore } = await import('/src/stores/cart-store')
useCartStore.getState().addItem({
  name: 'Test Shirt',
  productType: 't-shirt',
  service: 'dtf',
  quantity: 10,
  sizes: { M: 5, L: 5 },
  color: 'black',
  unitPrice: 15,
  totalPrice: 150,
})
console.log(useCartStore.getState().items)
```

## OUTPUT
- Write results to: /home/nick/Nick/Printguys-AI/printguys-nextjs/z-code-outputs/agent4-T008.md
- Include all files created
- End with "TASK_COMPLETED" if successful or "TASK_FAILED: [reason]" if not

## CONSTRAINTS
- Use Zustand persist middleware
- Handle hydration issues (SSR)
- Don't break existing stores
