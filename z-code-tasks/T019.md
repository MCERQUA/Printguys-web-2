# TASK T019: Basic Analytics Dashboard

## OBJECTIVE
Create admin analytics page with key metrics.

## PROJECT LOCATION
/home/nick/Nick/Printguys-AI/printguys-nextjs

## INSTRUCTIONS

1. Create analytics page at /src/app/admin/analytics/page.tsx:
```typescript
import { prisma } from '@/lib/prisma'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { DollarSign, TrendingUp, Package, Users, ArrowUp, ArrowDown } from 'lucide-react'

export default async function AdminAnalyticsPage() {
  const now = new Date()
  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate())
  const thisWeekStart = new Date(today)
  thisWeekStart.setDate(today.getDate() - 7)
  const thisMonthStart = new Date(now.getFullYear(), now.getMonth(), 1)
  const lastMonthStart = new Date(now.getFullYear(), now.getMonth() - 1, 1)
  const lastMonthEnd = new Date(now.getFullYear(), now.getMonth(), 0)

  // Fetch all stats
  const [
    todayRevenue,
    weekRevenue,
    monthRevenue,
    lastMonthRevenue,
    todayOrders,
    weekOrders,
    monthOrders,
    newCustomersMonth,
    topServices,
    revenueByDay,
  ] = await Promise.all([
    // Today's revenue
    prisma.order.aggregate({
      where: { createdAt: { gte: today }, status: { not: 'canceled' } },
      _sum: { totalAmount: true },
    }),
    // This week's revenue
    prisma.order.aggregate({
      where: { createdAt: { gte: thisWeekStart }, status: { not: 'canceled' } },
      _sum: { totalAmount: true },
    }),
    // This month's revenue
    prisma.order.aggregate({
      where: { createdAt: { gte: thisMonthStart }, status: { not: 'canceled' } },
      _sum: { totalAmount: true },
    }),
    // Last month's revenue (for comparison)
    prisma.order.aggregate({
      where: {
        createdAt: { gte: lastMonthStart, lte: lastMonthEnd },
        status: { not: 'canceled' },
      },
      _sum: { totalAmount: true },
    }),
    // Order counts
    prisma.order.count({ where: { createdAt: { gte: today } } }),
    prisma.order.count({ where: { createdAt: { gte: thisWeekStart } } }),
    prisma.order.count({ where: { createdAt: { gte: thisMonthStart } } }),
    // New customers this month
    prisma.user.count({ where: { createdAt: { gte: thisMonthStart } } }),
    // Top services (from order items - simplified)
    prisma.order.findMany({
      where: { createdAt: { gte: thisMonthStart } },
      select: { items: true },
    }),
    // Revenue by day (last 7 days)
    prisma.$queryRaw`
      SELECT DATE(created_at) as date, SUM(total_amount) as revenue, COUNT(*) as orders
      FROM orders
      WHERE created_at >= ${thisWeekStart} AND status != 'canceled'
      GROUP BY DATE(created_at)
      ORDER BY date DESC
    ` as Promise<{ date: Date; revenue: number; orders: number }[]>,
  ])

  const monthGrowth = lastMonthRevenue._sum.totalAmount
    ? ((monthRevenue._sum.totalAmount || 0) - lastMonthRevenue._sum.totalAmount) /
      lastMonthRevenue._sum.totalAmount * 100
    : 0

  return (
    <div>
      <h1 className="text-3xl font-bold mb-8">Analytics</h1>

      {/* Key Metrics */}
      <div className="grid sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <Card>
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-gray-500">Today's Revenue</CardTitle>
            <DollarSign className="h-4 w-4 text-emerald-500" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">
              ${(todayRevenue._sum.totalAmount || 0).toFixed(2)}
            </div>
            <p className="text-xs text-gray-500">{todayOrders} orders</p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-gray-500">This Week</CardTitle>
            <TrendingUp className="h-4 w-4 text-blue-500" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">
              ${(weekRevenue._sum.totalAmount || 0).toFixed(2)}
            </div>
            <p className="text-xs text-gray-500">{weekOrders} orders</p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-gray-500">This Month</CardTitle>
            <Package className="h-4 w-4 text-purple-500" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">
              ${(monthRevenue._sum.totalAmount || 0).toFixed(2)}
            </div>
            <div className="flex items-center text-xs">
              {monthGrowth >= 0 ? (
                <ArrowUp className="h-3 w-3 text-emerald-500 mr-1" />
              ) : (
                <ArrowDown className="h-3 w-3 text-red-500 mr-1" />
              )}
              <span className={monthGrowth >= 0 ? 'text-emerald-500' : 'text-red-500'}>
                {Math.abs(monthGrowth).toFixed(1)}% vs last month
              </span>
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-gray-500">New Customers</CardTitle>
            <Users className="h-4 w-4 text-orange-500" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{newCustomersMonth}</div>
            <p className="text-xs text-gray-500">This month</p>
          </CardContent>
        </Card>
      </div>

      {/* Revenue Chart (simplified table) */}
      <Card className="mb-8">
        <CardHeader>
          <CardTitle>Daily Revenue (Last 7 Days)</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="space-y-4">
            {(revenueByDay || []).map((day: any) => (
              <div key={day.date?.toString()} className="flex items-center justify-between">
                <span>{new Date(day.date).toLocaleDateString()}</span>
                <div className="flex items-center gap-4">
                  <span className="text-gray-500">{day.orders} orders</span>
                  <span className="font-medium w-24 text-right">
                    ${Number(day.revenue || 0).toFixed(2)}
                  </span>
                </div>
              </div>
            ))}
          </div>
        </CardContent>
      </Card>

      {/* Order Status Distribution */}
      <div className="grid md:grid-cols-2 gap-6">
        <Card>
          <CardHeader>
            <CardTitle>Order Status Distribution</CardTitle>
          </CardHeader>
          <CardContent>
            {/* Add status counts here */}
            <p className="text-gray-500">Status breakdown coming soon</p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle>Popular Services</CardTitle>
          </CardHeader>
          <CardContent>
            {/* Add service breakdown here */}
            <p className="text-gray-500">Service breakdown coming soon</p>
          </CardContent>
        </Card>
      </div>
    </div>
  )
}
```

## OUTPUT
- Write results to: /home/nick/Nick/Printguys-AI/printguys-nextjs/z-code-outputs/agent7-T019.md
- End with "TASK_COMPLETED" if successful
